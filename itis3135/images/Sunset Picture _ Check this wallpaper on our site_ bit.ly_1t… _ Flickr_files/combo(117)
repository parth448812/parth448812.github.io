YUI.add("hermes-template-coverphoto-context-menu",(function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t<div class="follow-options">\n\t\t\t<div class="mark-as-heading">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"header.MARK_AS_LABEL"},data:o,loc:{start:{line:4,column:32},end:{line:4,column:80}}}))+'</div>\n\t\t\t<div class="toggle-container friend-toggle-container"></div>\n\t\t\t<div class="toggle-container family-toggle-container"></div>\n\t\t</div>\n'},3:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=i(e,"if").call(r,null!=t?i(t,"canEditCoverPhoto"):t,{name:"if",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:3},end:{line:15,column:10}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"showHideFromFeed"):t,{name:"if",hash:{},fn:n.program(6,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:3},end:{line:22,column:10}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"showMute"):t,{name:"if",hash:{},fn:n.program(11,o,0),inverse:n.noop,data:o,loc:{start:{line:23,column:3},end:{line:29,column:10}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"canReport"):t,{name:"if",hash:{},fn:n.program(16,o,0),inverse:n.noop,data:o,loc:{start:{line:30,column:3},end:{line:32,column:10}}}))?a:"")+"\n"},4:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li class="context-item" data-id="change-coverphoto">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.CHANGE_COVER_PHOTO"},data:o,loc:{start:{line:14,column:57},end:{line:14,column:111}}}))+"</li>\n"},6:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isHiddenFromFeed"):t,{name:"if",hash:{},fn:n.program(7,o,0),inverse:n.program(9,o,0),data:o,loc:{start:{line:17,column:4},end:{line:21,column:11}}}))?a:""},7:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="show-in-feed">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.SHOW_GROUP_FEED"},data:o,loc:{start:{line:18,column:53},end:{line:18,column:103}}}))+"</li>\n"},9:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="hide-from-feed">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.HIDE_GROUP_FEED"},data:o,loc:{start:{line:20,column:55},end:{line:20,column:105}}}))+"</li>\n"},11:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isMuted"):t,{name:"if",hash:{},fn:n.program(12,o,0),inverse:n.program(14,o,0),data:o,loc:{start:{line:24,column:4},end:{line:28,column:11}}}))?a:""},12:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="unmute-notifications">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.UNMUTE_NOTIFICATIONS"},data:o,loc:{start:{line:25,column:61},end:{line:25,column:116}}}))+"</li>\n"},14:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="mute-notifications">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"groups.MUTE_NOTIFICATIONS"},data:o,loc:{start:{line:27,column:59},end:{line:27,column:112}}}))+"</li>\n"},16:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<li class="context-item" data-id="report">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.REPORT_ABUSE"},data:o,loc:{start:{line:31,column:46},end:{line:31,column:93}}}))+"</li>\n"},18:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"viewingSelf"):t,{name:"if",hash:{},fn:n.program(19,o,0),inverse:n.program(26,o,0),data:o,loc:{start:{line:36,column:3},end:{line:69,column:10}}}))?a:"")+"\t\t\t\n"},19:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=i(e,"if").call(r,null!=t?i(t,"canEditCoverPhoto"):t,{name:"if",hash:{},fn:n.program(20,o,0),inverse:n.noop,data:o,loc:{start:{line:37,column:4},end:{line:39,column:11}}}))?a:"")+(null!=(a=(i(e,"isFlipped")||t&&i(t,"isFlipped")||n.hooks.helperMissing).call(r,"enable-profile-info-edit-modal",{name:"isFlipped",hash:{},fn:n.program(22,o,0),inverse:n.program(24,o,0),data:o,loc:{start:{line:40,column:4},end:{line:45,column:18}}}))?a:"")},20:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="change-coverphoto">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"gallery.CHANGE_COVER_PHOTO"},data:o,loc:{start:{line:38,column:58},end:{line:38,column:112}}}))+"</li>\n"},22:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="edit-profile-info">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"profile.EDIT_PROFILE_INFO"},data:o,loc:{start:{line:41,column:58},end:{line:41,column:111}}}))+"</li>\n"},24:function(n,t,e,l,o){var a=null!=t?t:n.nullContext||{},r=n.hooks.helperMissing,i=n.escapeExpression,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item link" data-id="edit-username"><a href="/account#profile-details-settings">'+i((s(e,"intlMessage")||t&&s(t,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"header.EDIT_USERNAME"},data:o,loc:{start:{line:43,column:103},end:{line:43,column:151}}}))+'</a></li>\n\t\t\t\t\t<li class="context-item link" data-id="edit-real-name"><a href="/account#profile-details-settings">'+i((s(e,"intlMessage")||t&&s(t,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"header.EDIT_REAL_NAME"},data:o,loc:{start:{line:44,column:104},end:{line:44,column:153}}}))+"</a></li>\n"},26:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(a=i(e,"if").call(r,null!=t?i(t,"showGiftPro"):t,{name:"if",hash:{},fn:n.program(27,o,0),inverse:n.noop,data:o,loc:{start:{line:47,column:4},end:{line:51,column:11}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"isBlocked"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(29,o,0),data:o,loc:{start:{line:52,column:4},end:{line:58,column:11}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"showBlock"):t,{name:"if",hash:{},fn:n.program(32,o,0),inverse:n.noop,data:o,loc:{start:{line:59,column:4},end:{line:65,column:11}}}))?a:"")+(null!=(a=i(e,"if").call(r,null!=t?i(t,"canReport"):t,{name:"if",hash:{},fn:n.program(37,o,0),inverse:n.noop,data:o,loc:{start:{line:66,column:4},end:{line:68,column:11}}}))?a:"")},27:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="gift-pro">\n\t\t\t\t\t\t'+n.escapeExpression((a(e,"outlet")||t&&a(t,"outlet")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},null!=t?a(t,"gift-pro-view"):t,{name:"outlet",hash:{},data:o,loc:{start:{line:49,column:6},end:{line:49,column:30}}}))+"\n\t\t\t\t\t</li>\n"},29:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isBlockedBy"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(30,o,0),data:o,loc:{start:{line:53,column:5},end:{line:57,column:12}}}))?a:""},30:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,s=n.escapeExpression,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<li class="context-item link" data-id="send-message">\n\t\t\t\t\t\t\t<a href="'+s("function"==typeof(a=null!=(a=c(e,"flickrMailUrl")||(null!=t?c(t,"flickrMailUrl"):t))?a:i)?a.call(r,{name:"flickrMailUrl",hash:{},data:o,loc:{start:{line:55,column:16},end:{line:55,column:33}}}):a)+'">'+s((c(e,"intlMessage")||t&&c(t,"intlMessage")||i).call(r,{name:"intlMessage",hash:{intlName:"photo-card.SEND_A_MESSAGE"},data:o,loc:{start:{line:55,column:35},end:{line:55,column:88}}}))+"</a>\n\t\t\t\t\t\t</li>\n"},32:function(n,t,e,l,o){var a,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(a=r(e,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"isBlocked"):t,{name:"if",hash:{},fn:n.program(33,o,0),inverse:n.program(35,o,0),data:o,loc:{start:{line:60,column:5},end:{line:64,column:12}}}))?a:""},33:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<li class="context-item" data-id="unblock">'+n.escapeExpression((a(e,"intlHTMLMessage")||t&&a(t,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlHTMLMessage",hash:{username:null!=t?a(t,"displayname"):t,intlName:"photo-card.UNBLOCK_USER"},data:o,loc:{start:{line:61,column:49},end:{line:61,column:125}}}))+"</li>\n"},35:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t\t<li class="context-item" data-id="block">'+n.escapeExpression((a(e,"intlHTMLMessage")||t&&a(t,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlHTMLMessage",hash:{username:null!=t?a(t,"displayname"):t,intlName:"photo-card.BLOCK_USER"},data:o,loc:{start:{line:63,column:47},end:{line:63,column:121}}}))+"</li>\n"},37:function(n,t,e,l,o){var a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<li class="context-item" data-id="report">'+n.escapeExpression((a(e,"intlMessage")||t&&a(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{username:null!=t?a(t,"displayname"):t,intlName:"header.REPORT_USERNAME"},data:o,loc:{start:{line:67,column:47},end:{line:67,column:118}}}))+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,e,l,o){var a,r=null!=t?t:n.nullContext||{},i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="coverphoto-context-menu">\n'+(null!=(a=i(e,"if").call(r,null!=t?i(t,"isFollowing"):t,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.noop,data:o,loc:{start:{line:2,column:1},end:{line:8,column:8}}}))?a:"")+'\n\t<ul class="context-list">\n'+(null!=(a=i(e,"if").call(r,null!=t?i(t,"isGroup"):t,{name:"if",hash:{},fn:n.program(3,o,0),inverse:n.program(18,o,0),data:o,loc:{start:{line:11,column:2},end:{line:71,column:9}}}))?a:"")+"\t</ul>\n</div>\n"},useData:!0}),l={};n.Array.each([],(function(t){var e=n.Template.get("hermes/"+t);e&&(l[t]=e)})),n.Template.register("hermes/coverphoto-context-menu",(function(t,o){return(o=o||{}).partials=o.partials?n.merge(l,o.partials):l,e(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("coverphoto-context-menu-view",(function(e,i){"use strict";var t=require("hermes-core/flog")(i);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var t;return i.recipientNsid=i.pageNsid,this.params=i,this.params.isPersonPro=!!this.params.personModel&&this.params.personModel.getValue("isPro"),this.params.isFollowing=!!this.params.relationshipModel&&this.params.relationshipModel.getValue("isContact"),this.params.personModel&&(t=e.URLHelper.generatePersonUrls(this.params.personModel),this.params.flickrMailUrl=t.sendFlickrMail,this.params.displayname=this.params.personModel.getValue("displayname")),this},subviewConfig:{"gift-pro-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,placement:"context-menu",disabled:function(e){return!this.appContext.flipper.isFlipped("enable-gift-pro")||e.isGroup}}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("flickr-balls"),this},activate:function(){var i=this,t=this.get("container"),r=[];return t.addClass("loading"),i.params.isGroup&&(r.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then((function(t){return t?t.remoteReadUserPrefs({object_type:1},i.appContext):e.Promise.resolve()})).then((function(t){if(t&&t.userFeedPref){var r=t.userFeedPref.filter((function(e){return e.objectId===i.params.groupId}));i.isHiddenFromFeed=r.length>0&&"0"===r[0].prefValue}return e.Promise.resolve()}))),r.push(this.params.groupStatusHelper.load().then((function(){i.params.groupStatusHelper.update()})))),e.Promise.all(r).then((function(e){var r={};if(i.params.isGroup){var o=i.params.groupStatusHelper.getInfo();r={isGroup:!0,isHiddenFromFeed:i.isHiddenFromFeed,isMuted:o.groupAttrs.muted,canReport:!0,showHideFromFeed:o.groupAttrs.isMember,showMute:o.groupAttrs.isMember,canEditCoverPhoto:i.params.canEditCoverPhoto}}else r={isPersonPro:i.params.isPersonPro,isFollowing:i.params.isFollowing,flickrMailUrl:i.params.flickrMailUrl,isHiddenFromFeed:i.isHiddenFromFeed,canEditCoverPhoto:i.params.canEditCoverPhoto,viewingSelf:i.params.viewingSelf,showGiftPro:i.params.personModel.getValue("isEligibleForGifts"),isBlocked:!!i.params.relationshipModel&&i.params.relationshipModel.getValue("isIgnored"),isBlockedBy:!!i.params.relationshipModel&&i.params.relationshipModel.getValue("isIgnoredBy"),canReport:!0,displayname:i.params.displayname,showBlock:i.appContext.getViewer().signedIn};return i.setContainerWithTemplate("coverphoto-context-menu",r),i.friendToggleNode=t.one(".friend-toggle-container"),i.familyToggleNode=t.one(".family-toggle-container"),i.getSubviews()})).then((function(){return i.insertSubviews()})).then((function(){i.registerEventHandler(t.delegate("click",i.handleItemClick.bind(i),".context-item")),t.removeClass("loading"),setTimeout((function(){e.fire("droparound:reposition")}),0)}))},getSubviews:function(){var i=[],t=this;return this.params.isFollowing&&(i.push(this.appContext.getView("toggle-component-view",{type:"check",id:"coverphoto-context-mark-as-friend",labelText:this.intlMessage({intlName:"common.FRIEND"}),isBlock:!0,isChecked:this.params.relationshipModel.getValue("isFriend")}).then((function(e){return t.friendToggleView=e,e.initialize()}))),i.push(this.appContext.getView("toggle-component-view",{type:"check",id:"coverphoto-context-mark-as-family",labelText:this.intlMessage({intlName:"common.FAMILY"}),isBlock:!0,isChecked:this.params.relationshipModel.getValue("isFamily")}).then((function(e){return t.familyToggleView=e,e.initialize()})))),e.Promise.all(i)},insertSubviews:function(){var i=this,t=[];return this.friendToggleView&&(this.friendToggleNode.append(this.friendToggleView.get("container")),t.push(this.friendToggleView.activate())),this.familyToggleView&&(this.familyToggleNode.append(this.familyToggleView.get("container")),t.push(this.familyToggleView.activate())),e.Promise.all(t).then((function(){i.friendToggleView&&i.registerEventHandler(i.friendToggleView.on("toggled",i.handleFriendChange.bind(i))),i.familyToggleView&&i.registerEventHandler(i.familyToggleView.on("toggled",i.handleFamilyChange.bind(i)))}))},handleItemClick:function(e){var i=e.target.ancestor(".context-item",!0);this.fire("contextItemClicked",{itemId:i.getData("id")})},handleFriendChange:function(e){var i=this,r=this.params.relationshipModel,o=e.isChecked;return r.setValue("isFriend",o),r.remoteUpdate().catch((function(e){r.setValue("isFriend",!o),i.friendToggleView.toggleCheckedState(!o),t.error({err:e}),i.fire("friendChangeError")}))},handleFamilyChange:function(e){var i=this,r=this.params.relationshipModel,o=e.isChecked;return r.setValue("isFamily",o),r.remoteUpdate().catch((function(e){r.setValue("isFamily",!o),i.familyToggleView.toggleCheckedState(!o),t.error({err:e}),i.fire("familyChangeError")}))}})}),"@VERSION@",{requires:["flickr-view","hermes-template-coverphoto-context-menu","hermes-template-flickr-balls","url-helper"],optionalRequires:["hermes-core"],langBundles:["header","common","groups","photo-card","gallery","profile"]});YUI.add("hermes-template-profile-edit-real-name",(function(e,t){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,l,n,a){var i,s,o=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,c=e.escapeExpression,u="function",d=e.lambda,m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<form class="profile-edit-real-name">\n\t'+c((m(l,"outlet")||t&&m(t,"outlet")||r).call(o,null!=t?m(t,"basic-closeable-header-view"):t,{name:"outlet",hash:{},data:a,loc:{start:{line:2,column:1},end:{line:2,column:39}}}))+'\n\t<ul class="edit-container">\n\t\t<li class="edit-item first-name">\n\t\t\t<label class="edit-item-label" for="'+c(typeof(s=null!=(s=m(l,"selectorGuid")||(null!=t?m(t,"selectorGuid"):t))?s:r)===u?s.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:5,column:39},end:{line:5,column:55}}}):s)+'-edit-first-name">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.FIRST_NAME"},data:a,loc:{start:{line:5,column:73},end:{line:5,column:118}}}))+'</label>\n\t\t\t<div class="edit-input-container">\n\t\t\t\t<input type="text" class="edit-textbox edit-first-name" id="'+c(typeof(s=null!=(s=m(l,"selectorGuid")||(null!=t?m(t,"selectorGuid"):t))?s:r)===u?s.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:7,column:64},end:{line:7,column:80}}}):s)+'-edit-first-name" value="'+c(d(null!=(i=null!=t?m(t,"person"):t)?m(i,"firstName"):i,t))+'"/>\n\t\t\t\t<div class="error-message"></div>\n\t\t\t</div>\n\t\t</li>\n\t\t<li class="edit-item last-name">\n\t\t\t<label class="edit-item-label" for="'+c(typeof(s=null!=(s=m(l,"selectorGuid")||(null!=t?m(t,"selectorGuid"):t))?s:r)===u?s.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:12,column:39},end:{line:12,column:55}}}):s)+'-edit-last-name">'+c((m(l,"intlMessage")||t&&m(t,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.LAST_NAME"},data:a,loc:{start:{line:12,column:72},end:{line:12,column:116}}}))+'</label>\n\t\t\t<div class="edit-input-container">\n\t\t\t\t<input type="text" class="edit-textbox edit-last-name" id="'+c(typeof(s=null!=(s=m(l,"selectorGuid")||(null!=t?m(t,"selectorGuid"):t))?s:r)===u?s.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:14,column:63},end:{line:14,column:79}}}):s)+'-edit-last-name" value="'+c(d(null!=(i=null!=t?m(t,"person"):t)?m(i,"lastName"):i,t))+'"/>\n\t\t\t\t<div class="error-message"></div>\n\t\t\t</div>\n\t\t</li>\n\t</ul>\n\t'+c((m(l,"outlet")||t&&m(t,"outlet")||r).call(o,null!=t?m(t,"basic-confirm-actions-view"):t,{name:"outlet",hash:{},data:a,loc:{start:{line:19,column:1},end:{line:19,column:38}}}))+"\n</form>\n"},useData:!0}),n={};e.Array.each([],(function(t){var l=e.Template.get("hermes/"+t);l&&(n[t]=l)})),e.Template.register("hermes/profile-edit-real-name",(function(t,a){return(a=a||{}).partials=a.partials?e.merge(n,a.partials):n,l(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("profile-edit-real-name-view",(function(e,i){var t=require("hermes-core/flog")(i);require("hermes-core/type-validator");e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){return this.set("isActiveViewAgnostic",!0),this.params=i,this.publicProfileModel=this.params.publicProfileModel,this.selectorGuid=e.guid(),this.subviewConfig["basic-closeable-header-view"]=Object.assign(this.subviewConfig["basic-closeable-header-view"],{title:this.intlMessage({intlName:"header.EDIT_REAL_NAME"}),showCloseXButton:!0,onClose:this.handleCloseClick.bind(this)}),this.subviewConfig["basic-confirm-actions-view"]=Object.assign(this.subviewConfig["basic-confirm-actions-view"],{confirmButtonText:this.intlMessage({intlName:"common.DONE"}),confirmButtonType:"submit",onConfirm:this.handleSaveClick.bind(this),onCancel:this.handleCloseClick.bind(this)}),this},subviewConfig:{"basic-closeable-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"basic-confirm-actions-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){return Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("profile-edit-real-name",{person:this.params.person,selectorGuid:this.selectorGuid}),this},activate:function(){let e=this.get("container");this.firstNameInput=e.one(`.edit-textbox#${this.selectorGuid}-edit-first-name`),this.lastNameInput=e.one(`.edit-textbox#${this.selectorGuid}-edit-last-name`),this.firstNameErrorMessage=e.one(".first-name .error-message"),this.lastNameErrorMessage=e.one(".last-name .error-message"),this.firstNameInput.focus(),this.confirmView=this.subviews["basic-confirm-actions-view"],this.registerEventHandler(this.firstNameInput.on("keyup",this.handleInputChange.bind(this))),this.registerEventHandler(this.lastNameInput.on("keyup",this.handleInputChange.bind(this)))},handleSaveClick:function(e){e.halt();let i=this.firstNameInput.get("value"),s=this.lastNameInput.get("value");this.showSaving(),i!==this.publicProfileModel.getValue("firstName")||s!==this.publicProfileModel.getValue("lastName")?this.publicProfileModel.registry.remote.updateFirstAndLastName({id:this.publicProfileModel.getValue("id"),firstName:i,lastName:s},this.appContext).then((e=>{this.hideSaving(),this.fire("done",{valuesChanged:!0})})).catch((e=>{this.hideSaving(),t.error("Real name update failed",{err:e}),2===e.code?e.message&&(e.message.firstName&&(this.firstNameErrorMessage.set("text",this.intlMessage({intlName:"profile.INVALID_NAME"})),this.firstNameErrorMessage.addClass("shown"),this.firstNameInput.addClass("error")),e.message.lastName&&(this.lastNameErrorMessage.set("text",this.intlMessage({intlName:"profile.INVALID_NAME"})),this.lastNameErrorMessage.addClass("shown"),this.lastNameInput.addClass("error"))):this.confirmView.setMessageState({isShown:!0,message:this.intlMessage({intlName:"feed.RECOVERY_EMAIL_SOMETHING_WENT_WRONG"})})})):this.fire("done")},handleInputChange:function(e){var i=e.target;i===this.firstNameInput?(this.firstNameInput.removeClass("error"),this.firstNameErrorMessage.removeClass("shown")):i===this.lastNameInput&&(this.lastNameInput.removeClass("error"),this.lastNameErrorMessage.removeClass("shown"))},showSaving:function(){this.isSaving=!0,this.confirmView.setButtonState({confirm:"loading",cancel:"disabled"}),this.confirmView.setMessageState({isShown:!1})},hideSaving:function(){this.isSaving=!1,this.confirmView.resetButtonState()},handleCloseClick:function(e){this.fire("done")}})}),"@VERSION@",{requires:["flickr-view","hermes-template-profile-edit-real-name"],langBundles:["common","account-settings","feed","header","profile"]});YUI.add("hermes-template-profile-info-edit",(function(t,e){var l=t.Template.Handlebars.revive({1:function(t,e,l,n,a){return"empty"},3:function(t,e,l,n,a){var s,i,o=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,c=t.escapeExpression,d="function",u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t<li class="edit-item pro-badge">\n\t\t\t\t<div class="label edit-item-label">'+c((u(l,"intlMessage")||e&&u(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.PRO_BADGE"},data:a,loc:{start:{line:31,column:39},end:{line:31,column:83}}}))+'</div>\n\t\t\t\t<div class="edit-input-container">\n\t\t\t\t\t<ul class="badge-toggle-container">\n\t\t\t\t\t\t<li class="radio">\n\t\t\t\t\t\t\t<input type="radio" id="'+c(typeof(i=null!=(i=u(l,"selectorGuid")||(null!=e?u(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:35,column:31},end:{line:35,column:47}}}):i)+'-badge-toggle-radio-standard" name="badge-toggle-radio" value="standard"'+(null!=(s=(u(l,"ifCond")||e&&u(e,"ifCond")||r).call(o,null!=e?u(e,"badgeType"):e,"===","standard",{name:"ifCond",hash:{},fn:t.program(4,a,0),inverse:t.noop,data:a,loc:{start:{line:35,column:119},end:{line:35,column:186}}}))?s:"")+'>\n\t\t\t\t\t\t\t<label for="'+c(typeof(i=null!=(i=u(l,"selectorGuid")||(null!=e?u(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:36,column:19},end:{line:36,column:35}}}):i)+'-badge-toggle-radio-standard">\n\t\t\t\t\t\t\t\t<div></div>\n'+(null!=(s=t.invokePartial(u(n,"pro-badge"),e,{name:"pro-badge",hash:{noLink:!0,badgeType:"standard"},data:a,indent:"\t\t\t\t\t\t\t\t",helpers:l,partials:n,decorators:t.decorators}))?s:"")+'\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="radio">\n\t\t\t\t\t\t\t<input type="radio" id="'+c(typeof(i=null!=(i=u(l,"selectorGuid")||(null!=e?u(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:42,column:31},end:{line:42,column:47}}}):i)+'-badge-toggle-radio-legacy" name="badge-toggle-radio" value="standard"'+(null!=(s=(u(l,"ifCond")||e&&u(e,"ifCond")||r).call(o,null!=e?u(e,"badgeType"):e,"===","legacy",{name:"ifCond",hash:{},fn:t.program(4,a,0),inverse:t.noop,data:a,loc:{start:{line:42,column:117},end:{line:42,column:182}}}))?s:"")+'>\n\t\t\t\t\t\t\t<label for="'+c(typeof(i=null!=(i=u(l,"selectorGuid")||(null!=e?u(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:43,column:19},end:{line:43,column:35}}}):i)+'-badge-toggle-radio-legacy">\n\t\t\t\t\t\t\t\t<div></div>\n'+(null!=(s=t.invokePartial(u(n,"pro-badge"),e,{name:"pro-badge",hash:{noLink:!0,badgeType:"legacy"},data:a,indent:"\t\t\t\t\t\t\t\t",helpers:l,partials:n,decorators:t.decorators}))?s:"")+"\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</li>\n"},4:function(t,e,l,n,a){return' checked="checked"'},6:function(t,e,l,n,a){var s,i=null!=e?e:t.nullContext||{},o=t.hooks.helperMissing,r=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t\t\t<div class="web-address-item">'+r((c(l,"intlHTMLMessage")||e&&c(e,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{url:null!=(s=null!=e?c(e,"personUrls"):e)?c(s,"photostream"):s,intlName:"account-settings.YOUR_WEB_ADDRESSES_PHOTOSTREAM"},data:a,loc:{start:{line:57,column:35},end:{line:57,column:140}}}))+'</div>\n\t\t\t\t\t<div class="web-address-item">'+r((c(l,"intlHTMLMessage")||e&&c(e,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{url:null!=(s=null!=e?c(e,"personUrls"):e)?c(s,"profile"):s,intlName:"account-settings.YOUR_WEB_ADDRESSES_PROFILE"},data:a,loc:{start:{line:58,column:35},end:{line:58,column:132}}}))+"</div>\n"},8:function(t,e,l,n,a){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t\t\t<div class="web-address-item">'+t.escapeExpression((s(l,"intlHTMLMessage")||e&&s(e,"intlHTMLMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlHTMLMessage",hash:{url:"/profile_url.gne",intlName:"account-settings.CREATE_YOUR_WEB_ADD"},data:a,loc:{start:{line:60,column:35},end:{line:60,column:125}}}))+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,l,n,a){var s,i,o=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,c=t.escapeExpression,d="function",u=t.lambda,m=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="profile-info-edit">\n\t'+c((m(l,"outlet")||e&&m(e,"outlet")||r).call(o,null!=e?m(e,"basic-closeable-header-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:2,column:1},end:{line:2,column:39}}}))+'\n\n\t<ul class="edit-container">\n\t\t<li class="edit-item real-name">\n\t\t\t<div class="label edit-item-label" for="'+c(typeof(i=null!=(i=m(l,"selectorGuid")||(null!=e?m(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:6,column:43},end:{line:6,column:59}}}):i)+'-edit-real-name">'+c((m(l,"intlMessage")||e&&m(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.REAL_NAME"},data:a,loc:{start:{line:6,column:76},end:{line:6,column:120}}}))+'</div>\n\t\t\t<span class="edit-input-container">\n\t\t\t\t<span class="real-name-text">'+c(u(null!=(s=null!=e?m(e,"person"):e)?m(s,"firstName"):s,e))+" "+c(u(null!=(s=null!=e?m(e,"person"):e)?m(s,"lastName"):s,e))+'</span>\n\t\t\t\t<a\n\t\t\t\t\trole="button"\n\t\t\t\t\tid="'+c(typeof(i=null!=(i=m(l,"selectorGuid")||(null!=e?m(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:11,column:9},end:{line:11,column:25}}}):i)+'-edit-real-name"\n\t\t\t\t\tclass="edit-real-name-button\n\t\t\t\t\t'+(null!=(s=(m(l,"ifCond")||e&&m(e,"ifCond")||r).call(o,null!=(s=null!=e?m(e,"person"):e)?m(s,"firstName"):s,"||",null!=(s=null!=e?m(e,"person"):e)?m(s,"lastName"):s,{name:"ifCond",hash:{},fn:t.noop,inverse:t.program(1,a,0),data:a,loc:{start:{line:13,column:5},end:{line:13,column:70}}}))?s:"")+'">\n\n\t\t\t\t\t<span class="edit-text">'+c((m(l,"intlMessage")||e&&m(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"common.EDIT"},data:a,loc:{start:{line:15,column:29},end:{line:15,column:67}}}))+'</span>\n\t\t\t\t\t<span class="add-text">'+c((m(l,"intlMessage")||e&&m(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.ADD_YOUR_NAME"},data:a,loc:{start:{line:16,column:28},end:{line:16,column:76}}}))+'</span>\n\t\t\t\t</a>\n\t\t\t</span>\n\t\t</li>\n\n\t\t<li class="edit-item screen-name">\n\t\t\t<label class="edit-item-label" for="'+c(typeof(i=null!=(i=m(l,"selectorGuid")||(null!=e?m(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:22,column:39},end:{line:22,column:55}}}):i)+'-change-name-button">'+c((m(l,"intlMessage")||e&&m(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.SCREEN_NAME"},data:a,loc:{start:{line:22,column:76},end:{line:22,column:122}}}))+'</label>\n\t\t\t<span class="edit-input-container">\n\t\t\t\t<span>'+c(u(null!=(s=null!=e?m(e,"person"):e)?m(s,"username"):s,e))+'</span>\n\t\t\t\t<a id="'+c(typeof(i=null!=(i=m(l,"selectorGuid")||(null!=e?m(e,"selectorGuid"):e))?i:r)===d?i.call(o,{name:"selectorGuid",hash:{},data:a,loc:{start:{line:25,column:11},end:{line:25,column:27}}}):i)+'-change-name-button" href="/account/prefs/screenname/?from=personal">'+c((m(l,"intlMessage")||e&&m(e,"intlMessage")||r).call(o,{name:"intlMessage",hash:{intlName:"profile.CHANGE_NAME"},data:a,loc:{start:{line:25,column:96},end:{line:25,column:142}}}))+"</a>\n\t\t\t</span>\n\t\t</li>\n\n"+(null!=(s=m(l,"if").call(o,null!=e?m(e,"showBadgeToggle"):e,{name:"if",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:29,column:2},end:{line:51,column:9}}}))?s:"")+'\n\t\t<li class="edit-item web-addresses">\n\t\t\t<div class="label edit-item-label">'+c((m(l,"intlHTMLMessage")||e&&m(e,"intlHTMLMessage")||r).call(o,{name:"intlHTMLMessage",hash:{intlName:"account-settings.YOUR_WEB_ADDRESSES"},data:a,loc:{start:{line:54,column:38},end:{line:54,column:104}}}))+'</div>\n\t\t\t<div class="edit-input-container">\n'+(null!=(s=m(l,"if").call(o,null!=e?m(e,"hasPathAlias"):e,{name:"if",hash:{},fn:t.program(6,a,0),inverse:t.program(8,a,0),data:a,loc:{start:{line:56,column:4},end:{line:61,column:11}}}))?s:"")+"\t\t\t</div>\n\t\t</li>\n\t</ul>\n\n\t"+c((m(l,"outlet")||e&&m(e,"outlet")||r).call(o,null!=e?m(e,"basic-confirm-actions-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:66,column:1},end:{line:66,column:38}}}))+"\n</div>\n"},usePartial:!0,useData:!0}),n={};t.Array.each(["pro-badge","pro-badge"],(function(e){var l=t.Template.get("hermes/"+e);l&&(n[e]=l)})),t.Template.register("hermes/profile-info-edit",(function(e,a){return(a=a||{}).partials=a.partials?t.merge(n,a.partials):n,l(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge","hermes-template-pro-badge"]});YUI.add("profile-info-edit-view",(function(e,t){require("hermes-core/flog")(t);var i=require("hermes-core/type-validator");e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.set("isActiveViewAgnostic",!0),this.nsid=this.appContext.getViewer().nsid,this.selectorGuid=e.guid(),this.subviewConfig["basic-closeable-header-view"]=Object.assign(this.subviewConfig["basic-closeable-header-view"],{title:this.intlMessage({intlName:"profile.PROFILE_INFO"}),showCloseXButton:!0,onClose:this.handleCloseClick.bind(this)}),this.subviewConfig["basic-confirm-actions-view"]=Object.assign(this.subviewConfig["basic-confirm-actions-view"],{showCancelButton:!1,confirmButtonText:this.intlMessage({intlName:"common.DONE"}),onConfirm:this.handleCloseClick.bind(this)}),this},subviewConfig:{"basic-closeable-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"basic-confirm-actions-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){return e.Promise.all([this.appContext.getModel("person-models",this.nsid).then((e=>(this.personModel=e,this.personModel))),this.appContext.callAPI("flickr.prefs.getPrefs",{extras:"pro_badge_options, pro_badge"}).then((e=>(this.badgePrefs=e?e.viewPrefs:{},this.badgeType=this.badgePrefs.proBadge,this.badgePrefs))),this.appContext.getModel("person-public-profile-models",this.nsid).then((e=>(this.publicProfileModel=e,this.publicProfileModel)))])},buildContainer:function(){let t=this.badgePrefs,s=t.proBadgeOptions&&-1!==t.proBadgeOptions.indexOf("legacy"),a=e.URLHelper.generatePersonUrls(this.personModel),o=i.pathAlias(this.personModel.getValue("pathAlias")),l={firstName:this.publicProfileModel.getValue("firstName"),lastName:this.publicProfileModel.getValue("lastName"),username:this.personModel.getValue("username")};return this.setContainerWithTemplate("profile-info-edit",{person:l,showBadgeToggle:s,badgeType:this.badgeType,personUrls:{photostream:e.url(a.photostream),profile:e.url(a.profile)},hasPathAlias:o,selectorGuid:this.selectorGuid}),this},activate:function(){var e=this.get("container"),t=e.one(".badge-toggle-container");return this.closeXButton=e.one(".close-x-button"),this.doneButton=e.one(".basic-confirm-actions button.confirm"),this.errorMessageNode=e.one(".error-message"),this.realNameTextNode=e.one(".real-name-text"),this.editRealNameButton=e.one(".edit-real-name-button"),this.standardRadioButton=e.one(`#${this.selectorGuid}-badge-toggle-radio-standard`),this.legacyRadioButton=e.one(`#${this.selectorGuid}-badge-toggle-radio-legacy`),t&&this.registerEventHandler(t.delegate("change",this.handleBadgeToggleChange.bind(this),"input")),this.registerEventHandler(this.editRealNameButton.on("click",this.handleEditRealNameButtonClick.bind(this))),this},handleBadgeToggleChange:function(e){let t;e.target.get("id");e.target===this.standardRadioButton?t="standard":e.target===this.legacyRadioButton&&(t="legacy"),t!==this.badgeType&&this.appContext.callAPI("flickr.prefs.setPrefs",{pro_badge:t}).then((()=>{this.valuesChanged=!0,this.badgeType=t})).catch((e=>{"standard"===t?this.legacyRadioButton.set("checked",!0):this.standardRadioButton.set("checked",!0)}))},handleEditRealNameButtonClick:function(e){this.showRealNameModal()},handleCloseClick:function(e){this.fire("readyToClose")},showRealNameModal:function(t){let i={firstName:this.publicProfileModel.getValue("firstName"),lastName:this.publicProfileModel.getValue("lastName")},s=new e.Views["profile-edit-real-name-view"]({person:i,publicProfileModel:this.publicProfileModel,appContext:this.appContext});this.realNameModal=new e.Views.FluidModal({appContext:this.appContext,width:"550",subview:s,hasSubviewConfigRefactor:!0}),this.realNameModal.show(),setTimeout((()=>{let e=this.registerEventHandler(s.on("done",(t=>{if(t.valuesChanged){this.valuesChanged=!0;let e=this.publicProfileModel.getValue("firstName"),t=this.publicProfileModel.getValue("lastName");this.realNameTextNode.set("text",`${e} ${t}`),this.editRealNameButton.toggleClass("empty",!(e||t))}this.realNameModal.close(),this.detachRegisteredEvent(e)})))}),0)}})}),"@VERSION@",{requires:["flickr-view","profile-edit-real-name-view","hermes-template-profile-info-edit","url-helper","url"],langBundles:["common","account-settings","profile"]});YUI.add("fluid-coverphoto-editor",(function(t){"use strict";var e,o=2048,i=this.details.langBundles;e={dragging:{mouseDownY:0,previousY:0},potential:{y:0,height:0,width:0,url:"",id:0,aspectRatio:0},original:{width:0,height:0,url:""}},t.FluidCoverPhotoEditor=function(t,o,n){this.coverPhotoElement=t,e.original.url=t.getStyle("backgroundImage"),this.langBundles=i,this.appContext=o,this.view=n},t.FluidCoverPhotoEditor.prototype.loadCoverPhoto=function(o){var i,n,r,a=new Image,s=this;return new t.Promise((function(t,h){a.onload=function(){r=s._determineBoundaries(e.potential.height,e.potential.width),s.coverPhotoElement.setStyles({backgroundImage:"url("+a.src+")",backgroundPosition:"50% "+-1*r.min+"px",height:parseInt(s.coverPhotoElement.get("offsetHeight"),10)-parseInt(s.coverPhotoElement.getStyle("padding-top"),10)-parseInt(s.coverPhotoElement.getStyle("padding-bottom"),10)}),s.coverPhotoElement.addClass("editing"),s.setupEditorHandlers(),t()},e.potential.id=o.id,n=o.getValue("descendingSizes")[0],i=o.getValue("descendingSizes")[1],e.potential.width=i.width,e.potential.height=i.height,e.potential.url=i.url,e.original.width=n.width,e.original.height=n.height,e.potential.aspectRatio=o.getValue("aspectRatio"),a.src=i.url}))},t.FluidCoverPhotoEditor.prototype._convertYPositionForApi=function(t,i){var n=parseInt(this.coverPhotoElement.get("offsetHeight"),10),r=parseInt(this.coverPhotoElement.get("offsetWidth"),10);return Math.abs(e.potential.aspectRatio-e.original.width/e.original.height)>.01&&(i=e.original.height),((Math.abs(t)+n/2)*o/r-384)*i/o},t.FluidCoverPhotoEditor.prototype._determineBoundaries=function(t,e){var i,n=parseInt(this.coverPhotoElement.get("offsetWidth"),10),r=parseInt(this.coverPhotoElement.get("offsetHeight"),10);return 384,{min:i=384*n/o-r/2,max:n*t/e-i-r}},t.FluidCoverPhotoEditor.prototype.setupEditorHandlers=function(){var o=this,i=this._determineBoundaries(e.potential.height,e.potential.width);t.one(t.config.win.document.documentElement).addClass("disable-text-select"),this.coverPhotoElement.on(["mousedown","touchstart"],(function(t){var i=o.coverPhotoElement.getStyle("backgroundPosition").split(" "),n=2===i.length?parseInt(i[1],10):0;e.dragging.mouseDownY=t.pageY||(t.touches&&t.touches.length?t.touches[0].pageY:0)||(t.touches&&t.touches.length?t.touches[0].pageY:0),e.dragging.previousY=n,e.dragging.startDrag=!0,o.coverPhotoElement.addClass("grabbing")})),this.coverPhotoElement.on(["mouseup","touchend"],(function(){e.dragging.startDrag=!1,o.coverPhotoElement.removeClass("grabbing")})),this.coverPhotoElement.on(["mouseout","touchcancel"],(function(){e.dragging.startDrag=!1,o.coverPhotoElement.removeClass("grabbing")})),this.coverPhotoElement.on(["mousemove","touchmove"],(function(t){if(t.halt(),e.dragging.startDrag){var n=e.dragging.mouseDownY-(t.pageY||(t.touches&&t.touches.length?t.touches[0].pageY:0)),r=e.dragging.previousY-n,a=-1*i.min,s=-1*i.max;r=(r=r>=s?r:s)>a?a:r,e.potential.y=r,o.coverPhotoElement.setStyle("backgroundPosition","50% "+r+"px")}}))},t.FluidCoverPhotoEditor.prototype.cancelCoverPhotoEditing=function(){this.coverPhotoElement.removeClass("editing"),this.coverPhotoElement.setStyles({backgroundImage:e.original.url,backgroundPosition:"50% 50%",height:null}),this.coverPhotoElement.detachAll(),t.one(t.config.win.document.documentElement).removeClass("disable-text-select")},t.FluidCoverPhotoEditor.prototype.saveCoverPhoto=function(o){var i,n=this._convertYPositionForApi(e.potential.y,e.original.width),r={photo_id:e.potential.id,y:n};o&&(r.group_id=o,i="group"),this.coverPhotoElement.addClass("saving"),t.coverPhotoSaver.save(r,i).then((()=>{t.config.win.location.reload()})).catch((e=>{let o=new t.Views.FluidModal({appContext:this.appContext,subview:new t.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:e.message,showCancelButton:!1}),hasSubviewConfigRefactor:!0});o.show(),this.view.registerEventHandler(o.on("close",(()=>t.config.win.location.reload())))}))},t.mix(t.FluidCoverPhotoEditor.prototype,t.Localizable)}),"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom"],langBundles:["common"]});